(function(){var r,n,t,i;angular.module("app.controllers").controller("EditorController",function(r,u,f,e,o,s){return r.editing={},r.lookups={},r.lookups.currentDataFormat={},r.vocabulator={},r.$=$,u.get("../api/topics").success(function(n){return r.lookups.topics=n}),u.get("../api/formats?q=").success(function(t){return r.lookups.currentDataFormat=n(r.form.gemini.dataFormat,t),r.lookups.formats=t}),u.get("../api/roles?q=").success(function(n){return r.lookups.roles=n}),r.collapseDataFormatSelector=!0,r.collapseDateFormat=!0,r.getSecurityText=t,r.getDataFormatObj=n,r.updateDataFormatObj=i,r.cancel=function(){return r.reset(),r.lookups.currentDataFormat=n(r.form.gemini.dataFormat,r.lookups.formats),r.notifications.add("Edits cancelled")},r.open=function(n,t){n.preventDefault();n.stopPropagation();r[t]=!0},r.save=function(){var n;return n=function(n){var s,t,h,i,u,c,l,f;if(n.data.success)o=n.data.record,r.validation={},r.reset(),r.notifications.add("Edits saved"),e.path("/editor/"+o.id);else if(r.validation=n.data.validation,t=n.data.validation.errors,t.length>0)for(r.notifications.add("There were errors"),i=0,c=t.length;i<c;i++)for(s=t[i],f=s.fields,u=0,l=f.length;u<l;u++){h=f[u];try{r.theForm[h].$setValidity("server",!1)}catch(a){}}return r.busy.stop()},r.busy.start(),r.isNew()?u.post("../api/records",r.form).then(n):u.put("../api/records/"+o.id,r.form).then(n)},r.clone=function(){return e.path("/clone/"+r.form.id)},r.reset=function(){return r.form=angular.copy(o)},r.isNew=function(){return r.form.id==="00000000-0000-0000-0000-000000000000"},r.isClean=function(){return angular.equals(r.form,o)},r.isSaveHidden=function(){return r.isClean()||o.readOnly},r.isCancelHidden=function(){return r.isClean()},r.isSaveDisabled=function(){return r.isClean()},r.isCloneHidden=function(){return r.isNew()},r.isCloneDisabled=function(){return!r.isClean()},r.hasUsageConstraints=function(){return!!r.form.gemini.limitationsOnPublicAccess&&r.form.gemini.limitationsOnPublicAccess!=="no limitations"||!!r.form.gemini.useConstraints&&r.form.gemini.useConstraints!=="no conditions apply"},r.removeKeyword=function(n){return r.form.gemini.keywords.splice($.inArray(n,r.form.gemini.keywords),1)},r.addKeywords=function(n){var u,t,f,i;for(i=[],t=0,f=n.length;t<f;t++)u=n[t],i.push(r.form.gemini.keywords.push(u));return i},r.editKeywords=function(){var n;return n=s.open({controller:"VocabulatorController",templateUrl:"views/partials/vocabulator.html?"+(new Date).getTime(),size:"lg",scope:r}),n.result.then(function(n){return r.addKeywords(n)})["finally"](function(){return r.editing.keywords=!0})},r.editAbstract=function(){var n;return n=s.open({controller:"MarkdownController",templateUrl:"views/partials/markdown.html?"+(new Date).getTime(),size:"lg",resolve:{markdown:function(){return r.form.gemini.abstract}}}),n.result.then(function(n){return r.form.gemini.abstract=n})},r.removeExtent=function(n){return r.form.gemini.extent.splice($.inArray(n,r.form.gemini.extent),1)},r.addExtent=function(){return r.form.gemini.extent===null&&(r.form.gemini.extent=[]),r.form.gemini.extent.push({authority:"",code:""})},r.reset(),r.getKeywords=function(n){return u.get("../api/keywords?q="+n).then(function(n){return n.data})},r.setKeyword=function(n,t){return t.vocab=n.vocab}});t=function(n){switch(n){case 0:return"Official";case 1:return"Official-Sensitive";case 2:return"Secret"}};n=function(n,t){var i,r,u,f,o,s,e;if(n!==void 0&&t!==void 0){for(u=0,o=t.length;u<o;u++)for(r=t[u],e=r.formats,f=0,s=e.length;f<s;f++)if(i=e[f],i.name===n)return{type:r.name,text:i.name,code:i.code,glyph:r.glyph};return{text:"None Selected",glyph:"glyphicon-th"}}return{text:"Other",glyph:"glyphicon-th"}};i=function(t,i,r){return r.gemini.dataFormat=t,n(t,i)};r={errors:[{message:"There was an error"},{message:"There was another error"}]}}).call(this);