(function(){var i,c,n,r,u,f,e,t,o,s,h;angular.module("app.controllers").controller("EditorController",function(c,l,a,v,y,p,w){return w.then(function(n){return c.user=n}),c.editing={},c.lookups={},c.lookups.currentDataFormat={},c.recordOutput=y,c.vocabulator={},c.$=$,l.get("../api/topics").success(function(n){return c.lookups.topics=n}),l.get("../api/formats?q=").success(function(t){return c.lookups.currentDataFormat=n(c.form.gemini.dataFormat,t),c.lookups.formats=t}),l.get("../api/roles?q=").success(function(n){return c.lookups.roles=n}),c.collapseDataFormatSelector=!0,c.collapseDateFormat=!0,c.getSecurityText=e,c.getDataFormatObj=n,c.updateDataFormatObj=h,c.getPendingSignOff=f,c.getOpenDataButtonText=r,c.getOpenDataButtonToolTip=u,c.addOpenDataResource=i,c.removeOpenDataResource=o,c.trimDoubleQuotes=s,c.cancel=function(){return c.reset(),c.lookups.currentDataFormat=n(c.form.gemini.dataFormat,c.lookups.formats),c.notifications.add("Edits cancelled")},c.open=function(n,t){n.preventDefault();n.stopPropagation();c[t]=!0},c.successResponse=function(n){return c.reloadRecord(n),c.notifications.add("Edits saved")},c.reloadRecord=function(n){return c.recordOutput={record:n.record,recordState:n.recordState},c.validation={},c.reset(),c.status.refresh(),v.path("/editor/"+c.recordOutput.record.id)},c.save=function(){var n;return n=function(n){var f,t,e,i,r,o,s,u;if(n.data.success)c.successResponse(n.data);else if(c.validation=n.data.validation,t=n.data.validation.errors,t.length>0)for(c.notifications.add("There were errors"),i=0,o=t.length;i<o;i++)for(f=t[i],u=f.fields,r=0,s=u.length;r<s;r++){e=u[r];try{c.theForm[e].$setValidity("server",!1)}catch(h){}}return c.busy.stop()},c.busy.start(),c.isNew()?l.post("../api/records",c.form).then(n):l.put("../api/records/"+c.recordOutput.record.id,c.form).then(n)},c.clone=function(){return v.path("/clone/"+c.form.id)},c.reset=function(){return c.form=angular.copy(c.recordOutput.record)},c.isNew=function(){return c.form.id==="00000000-0000-0000-0000-000000000000"},c.isClean=function(){return angular.equals(c.form,c.recordOutput.record)},c.isSaveHidden=function(){return c.isClean()||c.recordOutput.record.readOnly},c.isCancelHidden=function(){return c.isClean()},c.isSaveDisabled=function(){return c.isClean()},c.isCloneHidden=function(){return c.isNew()},c.isCloneDisabled=function(){return!c.isClean()},c.isHttpPath=function(n){return n&&n.toLowerCase().startsWith("http")},c.isPublishingModalButtonEnabled=function(){return t(c.form.path)&&c.isSaveHidden()},c.isPublishingModalButtonVisible=function(){return c.form.publication&&c.form.publication.openData&&c.form.publication.openData.publishable===!0},c.hasUsageConstraints=function(){return!!c.form.gemini.limitationsOnPublicAccess&&c.form.gemini.limitationsOnPublicAccess!=="no limitations"||!!c.form.gemini.useConstraints&&c.form.gemini.useConstraints!=="no conditions apply"},c.removeKeyword=function(n){return c.form.gemini.keywords.splice($.inArray(n,c.form.gemini.keywords),1)},c.addKeywords=function(n){var r,t,u,i;for(i=[],t=0,u=n.length;t<u;t++)r=n[t],i.push(c.form.gemini.keywords.push(r));return i},c.editKeywords=function(){var n;return n=p.open({controller:"VocabulatorController",templateUrl:"views/partials/vocabulator.html?"+(new Date).getTime(),size:"lg",scope:c}),n.result.then(function(n){return c.addKeywords(n)})["finally"](function(){return c.editing.keywords=!0})},c.editAbstract=function(){var n;return n=p.open({controller:"MarkdownController",templateUrl:"views/partials/markdown.html?"+(new Date).getTime(),size:"lg",resolve:{markdown:function(){return c.form.gemini.abstract}}}),n.result.then(function(n){return c.form.gemini.abstract=n})},c.openPublishingModal=function(){var n;return n=p.open({controller:"OpenDataModalController",templateUrl:"views/partials/opendatamodal.html?"+(new Date).getTime(),size:"lg",scope:c,resolve:{recordOutput:function(){return c.recordOutput}},backdrop:"static"}),n.result.then(function(n){return c.reloadRecord(n)})},c.removeExtent=function(n){return c.form.gemini.extent.splice($.inArray(n,c.form.gemini.extent),1)},c.addExtent=function(){return c.form.gemini.extent===null&&(c.form.gemini.extent=[]),c.form.gemini.extent.push({authority:"",code:""})},c.reset(),c.getKeywords=function(n){return l.get("../api/keywords?q="+n).then(function(n){return n.data})},c.setKeyword=function(n,t){return t.vocab=n.vocab},c.fillManagerDetails=function(){return c.form.manager||(c.form.manager={}),c.form.manager.displayName=c.user.displayName},c.setPublishable=function(n){return c.form.publication||(c.form.publication={}),c.form.publication.openData||(c.form.publication.openData={}),c.form.publication.openData.publishable=n===!0&&c.form.publication.openData.publishable===!0||n===!1&&c.form.publication.openData.publishable===!1?null:n},c.togglePublishable=function(){return c.form.publication||(c.form.publication={}),c.form.publication.openData||(c.form.publication.openData={},c.form.publication.openData.publishable=null),c.form.publication.openData.publishable=c.form.publication.openData.publishable===null?!0:c.form.publication.openData.publishable===!0?!1:null}});t=function(n){return n&&n.match(/^([a-z]:|\\\\jncc-corpfile\\)/i)};i=function(n){return n.publication||(n.publication={}),n.publication.openData||(n.publication.openData={}),n.publication.openData.resources||(n.publication.openData.resources=[]),n.publication.openData.resources.push({path:""}),console.log(n.publication.openData.resources.length)};o=function(n,t){return n.publication.openData.resources.splice($.inArray(t,n.publication.openData.resources),1)};s=function(n){return n.match(/^(").*(")$/)?n.substring(1,n.length-1):n};u=function(n,i){return t(n.path)?n.publication===null||n.publication.openData===null||n.publication.openData.publishable!==!0?"The open data publication status of the record, editing the record may affect the status.":n.publication.openData.lastSuccess===null||n.publication.openData.lastSuccess===void 0||i.assessedAndUpToDate?"The open data publication status of the record, editing the record may affect the status.":"This record has been changed since it was last published, it may need republishing.":"Open data publishing not available for non-file resources"};r=function(n,t){return n.publication===null||n.publication.openData===null||n.publication.openData.publishable!==!0?"Publishable":n.publication.openData.lastSuccess===null||n.publication.openData.lastSuccess===void 0||t.assessedAndUpToDate?t.uploadedAndUpToDate?"Published":t.signedOffAndUpToDate?"Signed Off":t.assessedAndUpToDate?"Assessed":"Publishable":"Republish"};f=function(n){return n!==null&&n.openData.assessment.completed&&n.openData.signOff===null?!0:!1};e=function(n){switch(n){case 0:return"Official";case 1:return"Official-Sensitive";case 2:return"Secret"}};n=function(n,t){var i,r,u,f,o,s,e;if(n!==void 0&&t!==void 0){for(u=0,o=t.length;u<o;u++)for(r=t[u],e=r.formats,f=0,s=e.length;f<s;f++)if(i=e[f],i.name===n)return{type:r.name,text:i.name,code:i.code,glyph:r.glyph};return{text:"None Selected",glyph:"glyphicon-th"}}return{text:"Other",glyph:"glyphicon-th"}};h=function(t,i,r){return r.gemini.dataFormat=t,n(t,i)};c={errors:[{message:"There was an error"},{message:"There was another error"}]}}).call(this);